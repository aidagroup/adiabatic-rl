
"""
FOR EXPERIMENTAL EVALUATION!!
goes into all local subdirs x in ./ and creates a file x.csv. This file will have one header, one data row and 2 cols x_reward and x_length 
for every file in x.
Invocation: python3 src/gazebo_sim/utils/Evaluation/stoch_analyser.py ./results EXP2

This can then be associated with the csv file generated by slurm-exp using the assoc_data.py script in slurm-exp:
python3 ../../slurm-exp/assoc_data.py ../iccp-lf__EXP2_db.csv
You then have one big csv file with all results, can eg be imported into Excel or OOCalc

"""
import sys, os ;
SUFFIX = ".csv"
SEP = ","


if len(sys.argv) != 3:
  print("Directory param + filter param expected!") ;
  sys.exit(0) ;
base_dir,filter_str = sys.argv[1:3] ;

print(base_dir, filter_str) ;
dirs = sorted([os.path.join(base_dir,d) for d in os.listdir(base_dir) if os.path.isdir(os.path.join(base_dir,d)) and (d != ".") and (d != "..") and (d.find(filter_str) != -1)])
print("found", len(dirs))

combined_content = ""
for d in dirs:
  content_str = "" ;
  files = sorted([f for f in os.listdir(d) if f.find(SUFFIX) != -1], key=lambda s:int(s.split('_')[0]));
  print("Processing", d) ;
  for f in files:
    #print("Opening", os.path.join(d,f)) ;
    if str(f).find('train') != -1:
      continue
    content = open(os.path.join(d,f),"r",encoding="utf8").readlines() ;

    data = [[str(f) for f in l.strip().split(" ")] for l in content] ;
    acc_score = [] ;

    for line in data:
      acc_score.append(float(line[1])) ;
    content_str += f + "_score" + SEP 
    for i in acc_score:
        content_str = content_str + "%.02f"%(i) + SEP ;
    content_str = content_str + "\n"
  combined_content += str(os.path.basename(d)) + SEP + "\n" + content_str
  out = open(d + ".csv","w") ;
  out.write(content_str+"\n") ;
  out.close() ;
out = open(base_dir + "combined.csv","w") ;
out.write(combined_content+"\n") ;
out.close() ;

    

